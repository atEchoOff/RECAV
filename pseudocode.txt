for column j
    a = Float64[nz count]
    b = 0
    for row i and element q in nz(column)
        # preprocess so that i > j is implied
        a[scaled i] = v[i]' * (FH_ij - FL_ij)
        b += v[i]'FH_ij - entropy_ij
    
    theta = knapsack(a, b)

    (locked)
    for row i and element q in nz(column)
        r_H[i] += theta[scaled i] * FL_ij + (1 - theta[scaled i]) * FH_ij
        r_H[j] -= theta[scaled i] * FL_ij + (1 - theta[scaled i]) * FH_ij